# FSSP API Module

Модуль для работы с API-ФССП через платформу DaMIA. Предоставляет доступ к информации об исполнительных производствах в отношении физических и юридических лиц.

## Описание

Сервис API-ФССП предназначен для интеграции сведений Федеральной службы судебных приставов (ФССП России) об исполнительных производствах в отношении физических и юридических лиц, в любые информационные системы.

## Возможности

- Получение информации об исполнительных производствах юридических лиц
- Поиск участий юридических лиц в исполнительных производствах
- Получение информации об исполнительных производствах физических лиц
- Поиск участий физических лиц в исполнительных производствах
- Фильтрация по датам и регионам
- Поддержка группированного и негруппированного форматов данных

## Установка и настройка

### 1. Установка зависимостей

```bash
pip install aiohttp
```

### 2. Настройка API ключа

В файле `config.py` или через переменные окружения:

```python
# FSSP API для проверки исполнительных производств
FSSP_API_KEY = os.getenv('FSSP_API_KEY', 'ваш_ключ_доступа')
```

**Примечание:** FSSP API интегрирован через платформу DaMIA. Используйте тот же ключ, что и для других DaMIA сервисов.

## Методы API

### 1. Информация об исполнительном производстве ЮЛ (isp)

Получает актуальную информацию об исполнительном производстве юридического лица по его идентификационному номеру.

```python
from fssp_api import fssp_client

# Получение информации о производстве
result = await fssp_client.get_executive_proceeding_ul("10000/21/77003-ИП")

if result and result.get('status') == 'success':
    print(f"РегНомер: {result.get('regn')}")
    print(f"Данные: {result.get('data')}")
```

**Параметры:**
- `regn` (str): Номер исполнительного производства (индивидуального или сводного)

**Возвращает:** Информацию об исполнительном производстве

### 2. Информация об участиях ЮЛ в исполнительных производствах (isps)

Получает информацию об исполнительных производствах (как действительных, так и завершенных) юридического лица.

```python
# Получение производств по ИНН с группированным форматом
result = await fssp_client.get_company_proceedings(
    inn="7728898960",
    format=1,  # группированный
    page=1
)

# Получение с фильтрами по датам
result = await fssp_client.get_company_proceedings(
    inn="7728898960",
    from_date="2020-01-01",
    to_date="2020-12-31",
    format=2,  # негруппированный
    page=1
)
```

**Параметры:**
- `inn` (str): ИНН организации
- `from_date` (str, опционально): Дата возбуждения после (YYYY-MM-DD)
- `to_date` (str, опционально): Дата возбуждения до (YYYY-MM-DD)
- `format` (int): Тип формата (1 - группированный, 2 - негруппированный)
- `page` (int): Номер страницы (по умолчанию 1)

**Возвращает:** Информацию об исполнительных производствах

### 3. Информация об исполнительном производстве ФЛ (ispfl)

Получает актуальную информацию об исполнительном производстве физического лица или индивидуального предпринимателя.

```python
# Получение информации о производстве ФЛ
result = await fssp_client.get_executive_proceeding_fl("265623/22/02024-ИП")

if result and result.get('status') == 'success':
    print(f"Результат: {result.get('result')}")
```

**Параметры:**
- `regn` (str): Номер исполнительного производства (индивидуального)

**Возвращает:** Информацию об исполнительном производстве ФЛ

### 4. Информация об участиях ФЛ в исполнительных производствах (ispsfl)

Получает информацию об исполнительных производствах физического лица.

```python
# Поиск производств по ФИО и дате рождения
result = await fssp_client.get_person_proceedings(
    fam="Петров",
    nam="Иван",
    otch="Михайлович",
    bdate="06.01.1994",
    region=77,  # Москва
    format=1,   # группированный
    page=1
)

# Поиск без отчества и даты рождения
result = await fssp_client.get_person_proceedings(
    fam="Михайлов",
    nam="Николай",
    region=78,  # Санкт-Петербург
    format=2    # негруппированный
)
```

**Параметры:**
- `fam` (str): Фамилия должника
- `nam` (str): Имя должника
- `otch` (str, опционально): Отчество должника
- `bdate` (str, опционально): Дата рождения в формате DD.MM.YYYY
- `region` (int, опционально): Код региона отдела судебных приставов
- `format` (int): Тип формата (1 - группированный, 2 - негруппированный)
- `page` (int): Номер страницы (по умолчанию 1)

**Возвращает:** Информацию об исполнительных производствах ФЛ

## Форматы данных

### Группированный формат (format=1)

Данные группируются по категориям (активные/завершенные производства):

```json
{
  "ИНН": {
    "Активные": [...],
    "Завершенные": [...]
  }
}
```

### Негруппированный формат (format=2)

Данные возвращаются в виде плоского списка:

```json
{
  "ИНН": [...]
}
```

## Обработка ошибок

Все методы возвращают `None` при ошибке и логируют детали в лог:

```python
result = await fssp_client.get_company_proceedings("7728898960")

if result is None:
    print("Ошибка при получении данных")
elif result.get('status') == 'success':
    print("Данные получены успешно")
else:
    print(f"Ошибка API: {result.get('message')}")
```

## Тестирование

Для тестирования модуля используйте скрипт `test_fssp_api.py`:

```bash
python test_fssp_api.py
```

Скрипт тестирует:
- Соединение с API
- Все методы API
- Обработку ошибок
- Фильтрацию по датам

## Интеграция с supplier_checker

Модуль интегрирован с `supplier_checker.py` для комплексной проверки поставщиков:

```python
from supplier_checker import check_supplier

# Комплексная проверка поставщика
result = await check_supplier("7728898960")

# Данные ФССП доступны в result['fssp']
fssp_data = result['fssp']
print(f"Количество производств: {fssp_data.get('debts_count')}")
print(f"Активные дела: {fssp_data.get('active_cases')}")
print(f"Общая задолженность: {fssp_data.get('total_debt_amount')}")
```

## Примеры использования

### Проверка компании по ИНН

```python
import asyncio
from fssp_api import fssp_client

async def check_company(inn: str):
    # Получаем все производства компании
    result = await fssp_client.get_company_proceedings(inn, format=1)
    
    if result and result.get('status') == 'success':
        data = result.get('data', {})
        inn_data = data.get('ИНН', {})
        
        active = inn_data.get('Активные', [])
        completed = inn_data.get('Завершенные', [])
        
        print(f"Компания {inn}:")
        print(f"  Активных производств: {len(active)}")
        print(f"  Завершенных производств: {len(completed)}")
        
        # Выводим детали активных производств
        for proc in active[:3]:  # Первые 3
            print(f"    - {proc.get('Номер', 'Не указан')}: {proc.get('Сумма', 0)} ₽")
    else:
        print(f"Ошибка при получении данных для {inn}")

# Запуск
asyncio.run(check_company("7728898960"))
```

### Поиск физического лица

```python
async def find_person(fam: str, nam: str, bdate: str = None):
    result = await fssp_client.get_person_proceedings(
        fam=fam,
        nam=nam,
        bdate=bdate,
        format=1
    )
    
    if result and result.get('status') == 'success':
        data = result.get('result', {})
        print(f"Найдено производств для {fam} {nam}: {len(data)}")
        
        for proc in data:
            print(f"  - {proc.get('Номер', 'Не указан')}")
    else:
        print(f"Ошибка при поиске {fam} {nam}")

# Запуск
asyncio.run(find_person("Петров", "Иван", "06.01.1994"))
```

## Ограничения API

- Максимум 100 записей на страницу для юридических лиц
- Максимум 20 записей на страницу для физических лиц
- Требуется валидный API ключ
- Ограничения по частоте запросов (зависят от тарифного плана)

## Поддержка

При возникновении проблем:

1. Проверьте правильность API ключа
2. Убедитесь в доступности сервиса api.damia.ru
3. Проверьте логи на наличие ошибок
4. Убедитесь в корректности параметров запроса

## Ссылки

- [Документация API-ФССП](https://api.damia.ru/fssp)
- [Платформа DaMIA](https://damia.ru)
- [ФССП России](https://fssp.gov.ru) 