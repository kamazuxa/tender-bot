# 🤖 TenderBot — Telegram-бот для анализа госзакупок и проверки контрагентов

TenderBot — это современный Telegram-бот для анализа российских государственных закупок, поиска и проверки поставщиков, оценки рисков и генерации писем. Подходит для ИП, тендер-менеджеров, закупщиков.

---

## 🚀 Возможности

- 📦 Анализ тендеров (ИИ, GPT)
- 🦾 Проверка компании по ИНН (финансы, тендеры, ФССП, арбитраж)
- 📊 История закупок и аналитика по ключевым словам/ИНН
- 💼 Личный кабинет, история действий
- Интеграция с ExportBase, TenderGuru, FSSP, Арбитраж
- Умное меню, FSM, подсказки, валидация

---

## 🗂️ Структура файлов

```
📁 root
├── bot.py                # Главный бот, FSM, маршрутизация
├── analyzer.py           # Анализ тендеров (GPT)
├── downloader.py         # Скачивание документов
├── tender_history.py     # История закупок, аналитика
├── company_profile.py    # Карточка компании (агрегация)
├── exportbase_api.py     # API ExportBase
├── tenderguru_api.py     # API TenderGuru
├── fssp_api.py           # API ФССП
├── arbitr_api.py         # API Арбитраж
├── email_generator.py    # Генерация писем
├── handlers/
│   ├── analyze_handlers.py   # Обработка анализа тендера
│   ├── company_handlers.py   # Проверка компании
│   ├── history_handlers.py   # История закупок
├── utils/
│   └── validators.py     # Валидация, извлечение ИНН/тендера
├── texts.py              # Тексты и подсказки
├── keyboards.py          # Клавиатуры и кнопки
├── config.py             # Конфиг
```

## 🧩 Основные команды и сценарии

- `/start` — главное меню, выбор сценария
- `/analyze` — анализ тендера (ввод номера или ссылки)
- `/check` — проверка компании по ИНН
- `/history` — история закупок по ключевым словам или ИНН

### Кнопки главного меню:
- 📦 Анализ тендера
- 🦾 Проверить компанию
- 📊 История закупок
- 💼 Личный кабинет

## 🔗 Интеграция API
- **ExportBase** — финансы, профиль, контакты
- **TenderGuru** — история тендеров, победы, статистика
- **FSSP** — исполнительные производства
- **Арбитраж** — дела и споры
- **OpenAI GPT** — анализ ТЗ, генерация поисковых запросов

## 🛠️ FSM и обработчики
- Все сценарии реализованы через FSM и ConversationHandler
- Клавиатуры и тексты вынесены в отдельные модули
- Обработчики вынесены в `handlers/` по сценариям
- Валидация ИНН, тендера, ключевых слов — через utils/validators.py

## 🧪 Тестирование
- В `test_bot.py` реализованы тесты:
  - Получение профиля компании по ИНН
  - Вызов анализа тендера
  - Fallback при пустом ответе API
  - Извлечение номера тендера из строки/ссылки

## 💡 Расширение
- Подписка через Telegram Pay (в планах)
- WebApp-интерфейс
- Отчёты в PDF, выгрузка в Excel
- Личный кабинет с историей анализов

---

**TenderBot** — ваш ИИ-ассистент для госзакупок и проверки контрагентов!

---

## 🗂️ Архитектура и структура проекта

```
tender_bot_project/
├── bot.py
├── analyzer.py
├── downloader.py
├── tender_history.py
├── company_profile.py
├── email_generator.py
├── keyboards.py
├── texts.py
├── config.py
├── requirements.txt
├── setup.py
├── navigation_utils.py
├── states.py
│
├── handlers/
│   ├── analyze_handlers.py
│   ├── company_handlers.py
│   └── history_handlers.py
│
├── api/   (рекомендуется, сейчас api-модули в корне)
│   ├── exportbase_api.py
│   ├── tenderguru_api.py
│   ├── fssp_api.py
│   ├── arbitr_api.py
│
├── utils/
│   ├── validators.py
│   └── (session_store.py — если понадобится)
│
├── downloads/   (директория для скачанных файлов)
│
├── docs/   (вся документация и вспомогательные .md/.txt)
│   ├── README.md (этот файл)
│   ├── API_README.md
│   ├── SUPPLIER_CHECK_README.md
│   ├── FSSP_API_README.md
│   ├── ADMIN_PANEL_README.md
│   ├── NEW_FEATURES_README.md
│   ├── TENDER_HISTORY_README.md
│   ├── exportbase_api_doc.txt
│   └── ...
│
├── examples/   (примеры конфигов)
│   ├── config_example.py
│   └── env_example.txt
│
├── .gitignore
```

## Кратко:
- **В корне** — только основные модули, requirements.txt, setup.py, config.py
- **handlers/** — обработчики команд и логики
- **utils/** — утилиты и валидация
- **api/** — интеграции с внешними сервисами (можно переместить api-модули из корня)
- **downloads/** — временные/скачанные файлы
- **docs/** — вся документация и справочные материалы
- **examples/** — примеры конфигов и переменных окружения

## Удалено:
- test_bot.py, handlers.py, utils.py (устаревшие или дублирующие)

## Важно:
- Все импорты обновлены, дубликаты удалены
- requirements.txt теперь всегда в корне
- Структура чистая и оптимизирована для работы Copilot, Cursor и других инструментов

---

**Для обновления индексации используйте:**
```
cursor index --reset
```

---

Если добавляете новые модули — придерживайтесь этой структуры!

## 🔑 API и настройка

**Только нужные ключи:**
- `TELEGRAM_TOKEN` — токен Telegram-бота
- `EXPORTBASE_API_KEY` — ключ ExportBase (https://export-base.ru)
- `TENDERGURU_API_KEY` — ключ TenderGuru (если требуется)

**Установка:**
1. Скопируйте `env_example.txt` в `.env` и заполните ключи
2. Скопируйте `config_example.py` в `config.py` и настройте
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Запустите бота:
   ```bash
   python bot.py
   ```

---

## 💡 UX-сценарии

### `/start`
```
👋 Я помогу тебе с:
— анализом тендеров
— поиском и проверкой поставщиков
— оценкой рисков контрагента
```
Кнопки:
- 📦 Анализ тендера
- 🦾 Проверить компанию
- 📊 История закупок
- 💼 Личный кабинет

### 📦 Анализ тендера
- Введите номер тендера или ссылку
- Бот скачает и проанализирует документы
- Вы получите резюме, требования, рекомендации
- Кнопки:
  - 🔍 Найти поставщиков (ExportBase)
  - ⚠️ Проверить риски (FSSP+Арбитраж)
  - 📊 Показать похожие закупки

### 🦾 Проверка компании
- Введите ИНН или название
- Бот покажет:
  - ExportBase: контакты, финансы, тип бизнеса
  - TenderGuru: победы в тендерах, история
  - DaMIA: риски (суды + приставы)
- Кнопки:
  - ⚠️ Расширенная проверка (DaMIA)
  - ✉️ Сгенерировать письмо поставщику

### 📊 История закупок
- Сравнение с прошлыми тендерами
- Динамика цен, список участников, рекомендации

### ✉️ Генерация письма поставщику
- После поиска поставщика — кнопка "✉️ Сгенерировать письмо поставщику"
- Бот выдаёт готовый шаблон письма для копирования

---

## 🛠️ Модули
- **exportbase_api.py** — получение и форматирование данных по ИНН
- **tenderguru_api.py** — история тендеров
- **fssp_api.py** — исполнительные производства (DaMIA FSSP)
- **arbitr_api.py** — арбитражные дела (DaMIA)
- **company_profile.py** — агрегатор профиля компании
- **email_generator.py** — генерация шаблонов писем

---

## 🧑‍💻 Для разработчиков
- Код полностью асинхронный (async/await)
- Логика разбита по модулям и сервисам
- Легко расширять и заменять интеграции
- Тесты: `test_bot.py` (оставлены только нужные)

---

## 🐞 Поддержка и отладка
- Все логи — в файл `tender_bot.log`
- Ошибки и исключения логируются
- Для отладки используйте команды `/status`, `/cleanup`

---

## 📄 Лицензия
MIT 